/**
 * Complete Example: SQL to Array Transformation
 * This file demonstrates the complete transformation of the provided SQL data
 */

// Import the transformation utility
// In browser: include sql-to-array-transform.js first
// In Node.js: const { transformSqlToQuestions } = require('./sql-to-array-transform.js');

// The existing entitySetupQuestions array
const entitySetupQuestions = [
   {
      question_text: "Provide the full legal name of your company:",
      question_label: "Official Company Name",
      question_help:
         "The Company Name input field is formatted to facilitate document automation. Select the company suffix you prefer. If you select that you have already formed your company, enter your company name exactly as it is shown on your formation documents.",
      question_order: 1,
      is_required: 1,
      question_type: "org_name",
      suffix_options: ["LLC", ", LLC", "LP", ", LP", "Inc", ", Inc"],
      role_slug: "Company",
      record_type_slug: "org",
      field_type_slug: "name",
      slug_comp: "org:name",
   },
   {
      question_text: "Have you already formed your entity?",
      question_label: "Previously Formed",
      question_help:
         "If you've already formed your entity, we'll have you upload your documents to make sure everything is in place. These documents will also be used as a reference for other legal work.",
      question_order: 2,
      is_required: 1,
      question_type: "options",
      options: "Yes,No",
      default_value: "No",
      record_type_slug: "org",
      field_type_slug: "already_formed_entity",
      slug_comp: "org:already_formed_entity",
   },
   {
      question_text: "Select your entity type:",
      question_label: "Entity Type",
      question_order: 3,
      is_required: 1,
      question_type: "options",
      options: "LLC,LP,Corporation",
      role_slug: "Company",
      record_type_slug: "org",
      field_type_slug: "entity_type",
      slug_comp: "org:entity_type",
   },
   {
      question_text: "What type of LLC is this?",
      question_label: "LLC Type",
      question_order: 4,
      is_required: 1,
      required_slug_comp: "org:entity_type",
      required_question_value: "LLC",
      question_type: "options",
      options: "Operating Business,Fund Manager (GP) or Management Company",
      default_value: "Fund Manager (GP) or Management Company",
      role_slug: "Company",
      record_type_slug: "org",
      field_type_slug: "llc_type",
      slug_comp: "org:llc_type",
   },
   {
      question_text: "LP Type:",
      question_label: "LP Type",
      question_order: 5,
      is_required: 1,
      required_slug_comp: "org:entity_type",
      required_question_value: "LP",
      question_type: "options",
      options: "Multi-Asset Fund,Single-Asset Fund",
      role_slug: "Company",
      record_type_slug: "org",
      field_type_slug: "lp_type",
      slug_comp: "org:lp_type",
   },
   {
      question_text:
         "Please provide your entity's state of incorporation/formation:",
      question_label: "Domestic State",
      question_help:
         "Note: Your incorporation state may differ from your operating state(s). For example, many entities file in Delaware without having operations there.",
      question_order: 6,
      is_required: 1,
      question_type: "state",
      default_value: "Delaware",
      role_slug: "Company",
      record_type_slug: "org",
      field_type_slug: "filing_state",
      slug_comp: "org:filing_state",
   },
];

// Sample SQL results (parsed from the INSERT statement in the issue)
const sqlResults = [
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "string",
      feature_type_id: "1583",
      record_type_code: "org",
      feature: "partner_slug",
      value: "",
      question_text: "What Partner will your account be connected to?",
      question_comment: null,
      question_label: "Connected Partner Slug",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "string",
      feature_type_id: "940",
      record_type_code: "org",
      feature: "requisite_consent",
      value: "a majority",
      question_text: "Requisite Consent:",
      question_comment:
         'This should either be "a majority" or be set at a specific percentage "xx%".',
      question_label: "Requisite Consent",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "options",
      feature_type_id: "881",
      record_type_code: "org",
      feature: "account_business_type",
      value: "For-profit Company",
      question_text: "What type of business is this entity?",
      question_comment: null,
      question_label: "Business Type",
      options: "For-profit Company,Non-profit Company,Investment Vehicle,Other",
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "string",
      feature_type_id: "812",
      record_type_code: "org",
      feature: "address_inline_format",
      value: "2222 W Grand River Ave  Suite A  Okemos, Michigan 48864",
      question_text: "Company Address:",
      question_comment: null,
      question_label: "Company Address",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "options",
      feature_type_id: "648",
      record_type_code: "org",
      feature: "LLC_type",
      value: "Fund Manager (GP) or Management Company",
      question_text: "What type of LLC is this?",
      question_comment: null,
      question_label: "LLC Type",
      options:
         "Operating Business,Fund Manager (GP) or Management Company,Investment SPV,Series LLC (Master) (Delaware Only)",
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "document",
      feature_type_id: "457",
      record_type_code: "org",
      feature: "EIN_confirmation",
      value: "2009363522253",
      question_text: "Please upload your EIN confirmation letter",
      question_comment: "This is an optional upload.",
      question_label: "EIN Confirmation Letter",
      options: null,
      is_required: "0",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "options",
      feature_type_id: "327",
      record_type_code: "org",
      feature: "already_formed_entity",
      value: "Yes",
      question_text: "Have you already formed your entity?",
      question_comment: null,
      question_label: "Company Already Formed",
      options: "Yes,No",
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "date",
      feature_type_id: "229",
      record_type_code: "org",
      feature: "formation_filing_date",
      value: "Dec. 18, 2023",
      question_text: "What is your formation filing date?",
      question_comment:
         "Update this to match the stamped date on your certificate.",
      question_label: "Formation Filing Date",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "document",
      feature_type_id: "143",
      record_type_code: "org",
      feature: "operating_agreement",
      value: "2009386911815",
      question_text: "Please upload your Operating Agreement:",
      question_comment: null,
      question_label: "Operating Agreement",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "document",
      feature_type_id: "142",
      record_type_code: "org",
      feature: "certificate_of_formation",
      value: "2009366269857",
      question_text: "Please upload your Certificate of Formation:",
      question_comment: null,
      question_label: "Certificate of Formation",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "options",
      feature_type_id: "69",
      record_type_code: "org",
      feature: "entity_type",
      value: "LLC",
      question_text: "Select your entity type:",
      question_comment: null,
      question_label: "Entity Type",
      options:
         "Corporation,LLC,LP,LLC Series,LLC Series (RUV),LP Series,LP Series (SPV)",
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "state",
      feature_type_id: "68",
      record_type_code: "org",
      feature: "filing_state",
      value: "Michigan",
      question_text: "Domestic Filing State (Incorporation/Formation):",
      question_comment: null,
      question_label: "Domestic Filing State",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "social_security",
      feature_type_id: "60",
      record_type_code: "org",
      feature: "EIN",
      value: "934949568",
      question_text: "Enter your EIN:",
      question_comment: null,
      question_label: "EIN",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "string",
      feature_type_id: "51",
      record_type_code: "org",
      feature: "name",
      value: "Macrolight Trading, LLC",
      question_text: "Provide the full legal name of your company:",
      question_comment: "",
      question_label: "Official Company Name",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "phone",
      feature_type_id: "23",
      record_type_code: "org",
      feature: "phone_number",
      value: "+1 (248) 214-7957",
      question_text: "Best company contact phone number:",
      question_comment: null,
      question_label: "Company Phone",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "text",
      feature_type_id: "22",
      record_type_code: "org",
      feature: "description",
      value: "General Partner of Fund",
      question_text: "Briefly describe what your business  does:",
      question_comment:
         "This is a description for internal use and is not included in the filing document. It may, however, be used when required to list the NAICS code for state filings.",
      question_label: "Business Description",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "individual",
      feature_type_id: "21",
      record_type_code: "org",
      feature: "company_signatory",
      value: "Nicholas Ottoy",
      question_text: "Company Signatory:",
      question_comment: null,
      question_label: "Company Signatory",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "string",
      feature_type_id: "18",
      record_type_code: "org",
      feature: "initial_directors_count",
      value: "2",
      question_text: "Size of the board (number of directors):",
      question_comment: null,
      question_label: "Board Size",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Company",
      resource: "Macrolight Trading, LLC",
      feature_type: "address_universal",
      feature_type_id: "14",
      record_type_code: "org",
      feature: "address",
      value: "2222 W Grand River Ave \nSuite A \nOkemos, Michigan 48864   \nUnited States of America",
      question_text: "Company's Physical Address:",
      question_comment: null,
      question_label: "Company Address",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   // Individual records
   {
      resource_type: "Individual",
      resource: "Nicholas Ottoy",
      feature_type: "options",
      feature_type_id: "377",
      record_type_code: "indv",
      feature: "equity_type_LLC",
      value: "Stock No Vesting",
      question_text: "Issuance Type:",
      question_comment: "",
      question_label: "Issuance Type",
      options: "Stock With Vesting,Stock No Vesting",
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Individual",
      resource: "Nicholas Ottoy",
      feature_type: "radio",
      feature_type_id: "349",
      record_type_code: "indv",
      feature: "upload_or_generate",
      value: "Generate",
      question_text:
         "Would you like to upload or generate documents for this individual?",
      question_comment: null,
      question_label: "Upload or Generate",
      options: "Generate,Upload",
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Individual",
      resource: "Nicholas Ottoy",
      feature_type: "string",
      feature_type_id: "314",
      record_type_code: "indv",
      feature: "signatory_name",
      value: "Nicholas Ottoy",
      question_text: "Signatory Name:",
      question_comment: null,
      question_label: "Signatory Name",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Individual",
      resource: "Nicholas Ottoy",
      feature_type: "string",
      feature_type_id: "34",
      record_type_code: "indv",
      feature: "last_name",
      value: "Ottoy",
      question_text: "Last Name",
      question_comment: null,
      question_label: "Last Name",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Individual",
      resource: "Nicholas Ottoy",
      feature_type: "string",
      feature_type_id: "33",
      record_type_code: "indv",
      feature: "first_name",
      value: "Nicholas",
      question_text: "First Name:",
      question_comment: null,
      question_label: "First Name",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Individual",
      resource: "Nicholas Ottoy",
      feature_type: "boolean",
      feature_type_id: "10",
      record_type_code: "indv",
      feature: "is_officer",
      value: "1",
      question_text: "Select if this person is a company officer.",
      question_comment: null,
      question_label: "Is Officer",
      options: null,
      is_required: "0",
      account_id: "61209462",
   },
   {
      resource_type: "Individual",
      resource: "Nicholas Ottoy",
      feature_type: "boolean",
      feature_type_id: "9",
      record_type_code: "indv",
      feature: "is_board_director",
      value: "1",
      question_text:
         "Select if this individual is on the company's board of directors/managers.",
      question_comment: null,
      question_label: "Board Director",
      options: null,
      is_required: "0",
      account_id: "61209462",
   },
   {
      resource_type: "Individual",
      resource: "Nicholas Ottoy",
      feature_type: "options",
      feature_type_id: "7",
      record_type_code: "indv",
      feature: "title",
      value: "Manager",
      question_text: "Title(s):",
      question_comment:
         "Custom options are allowed. Leave blank if not applicable.",
      question_label: "Title(s)",
      options:
         "President,Secretary,CEO,Authorized Signatory,Manager,Treasurer,CTO,COO,Vice President",
      is_required: "0",
      account_id: "61209462",
   },
   {
      resource_type: "Individual",
      resource: "Nicholas Ottoy",
      feature_type: "email",
      feature_type_id: "2",
      record_type_code: "indv",
      feature: "email",
      value: "bnsharedserver@gmail.com",
      question_text: "Email Address:",
      question_comment: null,
      question_label: "Email Address",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Individual",
      resource: "Nicholas Ottoy",
      feature_type: "person_name",
      feature_type_id: "1",
      record_type_code: "indv",
      feature: "name",
      value: "Nicholas Ottoy",
      question_text: "Full Legal Name:",
      question_comment: null,
      question_label: "Full Legal Name",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   // State records
   {
      resource_type: "State",
      resource: "Michigan",
      feature_type: "options",
      feature_type_id: "415",
      record_type_code: "st",
      feature: "state_type",
      value: "Domestic",
      question_text: "State Type:",
      question_comment: null,
      question_label: "State Type",
      options: "Domestic,Foreign",
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "State",
      resource: "Michigan",
      feature_type: "state",
      feature_type_id: "332",
      record_type_code: "st",
      feature: "operating_state",
      value: "Michigan",
      question_text: "State:",
      question_comment: null,
      question_label: "State",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   // Task records
   {
      resource_type: "Task",
      resource: "Organizational Documents",
      feature_type: "date",
      feature_type_id: "404",
      record_type_code: "task",
      feature: "effective_date",
      value: "Oct. 7, 2025",
      question_text: "What is the effective date for this document?",
      question_comment: null,
      question_label: "Effective Date",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Task",
      resource: "Organizational Documents",
      feature_type: "string",
      feature_type_id: "130",
      record_type_code: "task",
      feature: "name",
      value: "Organizational Documents",
      question_text: "Name:",
      question_comment: null,
      question_label: "Name",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   // Equity Class records
   {
      resource_type: "Equity Class",
      resource: "Common Units",
      feature_type: "integer",
      feature_type_id: "782",
      record_type_code: "eq_cl",
      feature: "votes_per_share",
      value: "1",
      question_text: "Votes Per Share:",
      question_comment: null,
      question_label: "Votes Per Share",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Equity Class",
      resource: "Common Units",
      feature_type: "options",
      feature_type_id: "763",
      record_type_code: "eq_cl",
      feature: "type",
      value: "Common",
      question_text: "Share Class Type:",
      question_comment: null,
      question_label: "Share Class Type",
      options: "Common,Preferred",
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Equity Class",
      resource: "Common Units",
      feature_type: "integer",
      feature_type_id: "658",
      record_type_code: "eq_cl",
      feature: "authorized_shares",
      value: "10,000,000",
      question_text: "Authorized Shares/Units:",
      question_comment: null,
      question_label: "Authorized Shares/Units",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
   {
      resource_type: "Equity Class",
      resource: "Common Units",
      feature_type: "string",
      feature_type_id: "656",
      record_type_code: "eq_cl",
      feature: "name",
      value: "Common Units",
      question_text: "Name of Equity Class:",
      question_comment: "E.g., Common Stock (Common Units for LLCs)",
      question_label: "Name of Equity Class",
      options: null,
      is_required: "1",
      account_id: "61209462",
   },
];

// Function to transform SQL results (inline version for demonstration)
function transformSqlToQuestions(sqlResults, existingQuestions = []) {
   const existingSlugComps = new Set(existingQuestions.map((q) => q.slug_comp));

   const transformedQuestions = sqlResults
      .map((row) => {
         const slugComp = `${row.record_type_code}:${row.feature}`;

         if (existingSlugComps.has(slugComp)) {
            return null;
         }

         const question = {
            question_text: row.question_text,
            question_label: row.question_label,
            question_order: null,
            is_required: row.is_required,
            question_type: row.feature_type,
            record_type_slug: row.record_type_code,
            field_type_slug: row.feature,
            slug_comp: slugComp,
         };

         if (row.question_comment) {
            question.question_help = row.question_comment;
         }

         if (row.resource_type) {
            question.role_slug = row.resource_type;
         }

         if (row.options) {
            question.options = row.options;
         }

         if (row.value) {
            question.default_value = row.value;
         }

         return question;
      })
      .filter((q) => q !== null);

   return transformedQuestions;
}

// Perform the transformation
const newQuestions = transformSqlToQuestions(sqlResults, entitySetupQuestions);

// Log results
console.log("=== Transformation Results ===");
console.log(`Total SQL records: ${sqlResults.length}`);
console.log(`Existing questions: ${entitySetupQuestions.length}`);
console.log(`New questions (after filtering): ${newQuestions.length}`);
console.log("\n=== New Questions Array ===");
console.log(JSON.stringify(newQuestions, null, 2));

// Export for use in Node.js or browser
if (typeof module !== "undefined" && module.exports) {
   module.exports = {
      entitySetupQuestions,
      sqlResults,
      newQuestions,
      transformSqlToQuestions,
   };
}
